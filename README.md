# 消息盒子 (Message Box)

消息盒子是一个Android应用，用于监听设备上的通知消息，并将其转发到HTTP服务器或MQTT服务器。这个应用可以帮助用户实现设备间的消息同步、远程通知监控等功能。

主要作用与智能家居实现语音控制。

方案分享
一 ：在手机上的智能家居软件上（例如：华为的智慧生活）
     添加场景-条件：语音控制（例如：打开客厅灯）--动作：消息通知（例如： ha:kt-d-1）

二 ：在消息盒子上的配置
     配置：http或者mqtt - 监听应用（智慧生活）-过滤词（ha:）

三 ：在服务端的配置（例如Home Assistant）
     自动化中配置：
     http：每当（当收到某个 Webhook 有效载荷时）Webhook ID （例如： ha:kt-d-1）就执行（例如：打开客厅灯）
     mqtt：每当（当收到某个 MQTT 消息时）主题：（与配置的主题一致） 有效负载 （例如： ha:kt-d-1）就执行（例如：打开客厅灯）

这样就可以通手机的语音助手（例如：小艺）打开家里的灯。

## 功能特点

- **多种转发方式**：支持HTTP和MQTT两种转发方式
- **应用筛选**：可以选择只监听特定应用的通知
- **关键词过滤**：支持通过关键词过滤通知内容
- **自定义模板**：MQTT模式下支持自定义消息模板
- **后台运行**：支持在后台持续监听通知
- **低电耗设计**：针对长时间运行进行了电池优化

## 安装要求

- Android 10.0 (API 29) 更高版本请自行修改获得支持
- 需要授予通知访问权限
- 建议关闭电池优化以确保后台稳定运行

## 使用方法

### 权限设置

首次使用时，需要授予以下权限：

1. **通知访问权限**：允许应用读取系统通知
2. **电池优化豁免**：确保应用在后台稳定运行

在应用主界面点击右上角的菜单按钮，进入权限设置页面，按照提示完成权限授予。

### 创建配置

应用支持两种转发配置：

#### HTTP配置

1. 在主界面点击右上角的 "+" 按钮，选择 "HTTP配置"
2. 填写以下信息：
   - **配置名称**：为该配置起一个名字
   - **请求URL**：接收通知的HTTP服务器地址，支持变量：
     - `$title`：通知标题
     - `$text`：通知内容
   - **选择应用**：选择要监听的应用
   - **过滤关键词**：设置关键词过滤（可选，多个关键词用逗号分隔）
3. 点击保存按钮完成配置

#### MQTT配置

1. 在主界面点击右上角的 "+" 按钮，选择 "MQTT配置"
2. 填写以下信息：
   - **服务名称**：为该配置起一个名字
   - **服务器地址**：MQTT代理服务器地址
   - **端口**：MQTT服务器端口（默认1883）
   - **客户端ID**：MQTT客户端标识（可选，留空自动生成）
   - **订阅主题**：发布消息的主题
   - **用户名/密码**：MQTT服务器认证信息（如需）
   - **消息模板**：自定义消息格式，支持变量：
     - `$title`：通知标题
     - `$text`：通知内容
   - **选择应用**：选择要监听的应用
   - **过滤关键词**：设置关键词过滤（可选）
3. 点击保存按钮完成配置

### 启动服务

完成配置后，在主界面点击右下角的启动按钮（播放图标）即可启动服务。服务启动后，图标会变为红色停止图标，表示服务正在运行。

## 常见问题

### 服务无法在后台持续运行

- 确保已授予通知访问权限
- 在系统设置中关闭应用的电池优化
- 某些系统可能需要在系统自启动管理中允许应用自启动

### 无法接收到某些应用的通知

- 确保选择了正确的应用
- 检查过滤关键词设置是否过于严格
- 某些应用的通知可能使用特殊格式，可能需要调整配置

### HTTP请求失败

- 检查URL格式是否正确
- 确保网络连接正常
- 验证目标服务器是否正常运行并接受请求

### MQTT连接问题

- 检查服务器地址和端口是否正确
- 验证用户名和密码
- 确保网络连接稳定

## 隐私说明

消息盒子会读取设备上的通知内容，但所有数据仅用于转发到用户配置的服务器，不会收集或上传到其他地方。应用不包含任何广告或分析跟踪代码。
